<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Js - æ‰‹æ’¸ Prmoise - ç®€æ˜“ç‰ˆæœ¬ | Cxsuay</title>
    <meta name="description" content="Keep on going never give up">
    <link rel="stylesheet" href="/assets/style.c542bb22.css">
    <link rel="modulepreload" href="/assets/Home.c9153eec.js">
    <link rel="modulepreload" href="/assets/app.f2ffefc6.js">
    <link rel="modulepreload" href="/assets/docs_Js_Codes-promise.md.7b867a41.lean.js">
    <link rel="modulepreload" href="/assets/app.f2ffefc6.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="twitter:title" content="Js - æ‰‹æ’¸ Prmoise - ç®€æ˜“ç‰ˆæœ¬ | Cxsuay">
    <meta property="og:title" content="Js - æ‰‹æ’¸ Prmoise - ç®€æ˜“ç‰ˆæœ¬ | Cxsuay">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Cxsuay, back to home" data-v-40587210 data-v-7ac13a1e><img class="logo" src="/avatar.jpg" alt="Logo" data-v-7ac13a1e> Cxsuay</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>é¦–é¡µ <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-dropdown-link" data-v-35b91e7e data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>å¼•å¯¼</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/docs/Js/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Js-adv/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js-adv</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Node/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Node</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Vue/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Vue</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://gitee.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Gitee(ç äº‘) <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>é¦–é¡µ <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-dropdown-link" data-v-35b91e7e data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>å¼•å¯¼</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/docs/Js/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Js-adv/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js-adv</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Node/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Node</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Vue/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Vue</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://gitee.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Gitee(ç äº‘) <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><p class="sidebar-link-item"></p><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js">Js</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Array">Array</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Class">Class</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Closure">Closure</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Code">Code</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/docs/Js/Codes-promise">Codes-promise</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#å£°æ˜-promise-å¹¶ç»‘å®š-this">å£°æ˜ Promise å¹¶ç»‘å®š this</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·">çŠ¶æ€ä¿æŠ¤ ä¸ æ‰§è¡Œè€…å¼‚æ­¥æ•è·</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#then-çš„åŸºç¡€æ„å»º">then çš„åŸºç¡€æ„å»º</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·">å®ç° then çš„ å¼‚æ­¥æ“ä½œ å’Œ å¼‚å¸¸æ•è·</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-çš„-pending-çŠ¶æ€å¤„ç†">Promise çš„ Pending çŠ¶æ€å¤„ç†</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†">pending çš„çŠ¶æ€å¼‚å¸¸å¤„ç†</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§">pending çš„å¼‚æ­¥å¤„ç†æŠ€å·§</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#then-é“¾å¼æ“ä½œ">then é“¾å¼æ“ä½œ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å®ç°-then-çš„-ç©¿é€ä¼ é€’">å®ç° then çš„ ç©¿é€ä¼ é€’</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#then-è¿”å›-promise-çš„å¤„ç†">then è¿”å› promise çš„å¤„ç†</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–">then ä»£ç çš„ å†—ä½™ ä¼˜åŒ–</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-è¿”å›ç±»å‹çš„çº¦æŸ">promise è¿”å›ç±»å‹çš„çº¦æŸ</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#å®ç°-resolve-ä¸-reject">å®ç° resolve ä¸ reject</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-çš„-all-æ–¹æ³•å®ç°">promise çš„ All æ–¹æ³•å®ç°</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°">promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç ">æœ€å è´´æœ€åå®ç°çš„ å…¨éƒ¨ä»£ç </a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Copy">Copy</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/EventLoop">EventLoop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Function">Function</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Methods">Methods</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Modular">Modular</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Object">Object</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Promise">Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/RegExp">RegExp</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Sub">Sub</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Symbol">Symbol</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js-adv">Js-adv</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js-adv/Type">Type</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node">Node</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node/Api">Api</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node/Guide">Guide</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue">Vue</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue/Base">Base</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue/Component">Component</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="js-æ‰‹æ’¸-prmoise-ç®€æ˜“ç‰ˆæœ¬" tabindex="-1">Js - æ‰‹æ’¸ <code>Prmoise</code> - ç®€æ˜“ç‰ˆæœ¬ <a class="header-anchor" href="#js-æ‰‹æ’¸-prmoise-ç®€æ˜“ç‰ˆæœ¬" aria-hidden="true">#</a></h1><h2 id="å£°æ˜-promise-å¹¶ç»‘å®š-this" tabindex="-1">å£°æ˜ <code>Promise</code> å¹¶ç»‘å®š <code>this</code> <a class="header-anchor" href="#å£°æ˜-promise-å¹¶ç»‘å®š-this" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>
  <span class="token comment">// å› ä¸ºçŠ¶æ€çš„å€¼æ˜¯å›ºå®šçš„ æ‰€ä»¥å®šä¹‰æˆé™æ€å±æ€§</span>
  <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>
  <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>
  <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>

  <span class="token comment">// executor - ç¿»è¯‘ - æ‰§è¡Œè€… çš„æ„æ€</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// executor - å°±æ˜¯ - resolve å’Œ reject</span>
    <span class="token comment">// æˆ‘å‚»äº† constructor ä¸å°±æ˜¯ä¼ é€’ new çš„æ—¶å€™ä¼ é€’çš„æ—¶å€™ ä¼ é€’çš„å‚æ•°å—...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹æ˜¯ pending çŠ¶æ€</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹è¿”å›å€¼</span>

    <span class="token comment">// âš ï¸ å› ä¸ºthis ç¼˜æ•… ç„¶å bind ç»‘å®šä¸‹ thisã€‚ è®©é‡Œé¢çš„ this å°±æ˜¯å½“å‰çš„ this;</span>
    <span class="token comment">// ğŸ“ è¿™é‡Œæ˜¯ ç»‘å®š `this` - `bind()æ–¹æ³•`</span>
    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œ</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ä½†æ˜¯è¿™æ ·å†™å°±è¿èƒŒäº† promise çš„å•ä¸€ä¸å¯é€†çŠ¶æ€çš„ åŸåˆ™...</span>
  <span class="token comment">// å› ä¸ºè¿™æ ·å†™ ä»ä¸Šå¾€ä¸‹ æ‰§è¡Œ å°±æ˜¯ æœ€ä¸‹æ–¹çš„çŠ¶æ€æ˜¯å“ªä¸ª å°±æ˜¯å“ªä¸ªçŠ¶æ€</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(this); // undefined å› ä¸º class é»˜è®¤éµå¾ªçš„æ˜¯ä¸¥æ ¼å±æ€§</span>
    <span class="token comment">// ç„¶å å°±æ˜¯ undefined - å¦‚æœä¸æ˜¯çš„è¯ è¿™é‡Œé¢çš„ this å°±æ˜¯window</span>
    
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·" tabindex="-1"><code>çŠ¶æ€ä¿æŠ¤</code> ä¸ <code>æ‰§è¡Œè€…å¼‚æ­¥æ•è·</code> <a class="header-anchor" href="#çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·" aria-hidden="true">#</a></h2><ul><li><p><code>æ‰§è¡Œè€…å¼‚æ­¥æ•è·</code> - å¦‚æœåœ¨è°ƒç”¨ä»£ç çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œç„¶åå°±éœ€è¦ æŠŠçŠ¶æ€æ”¹æˆ <code>reject</code></p></li><li><p>æ•è·é”™è¯¯ï¼Œtry-catch</p><div class="language-js"><pre><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ğŸ“`æ‰§è¡Œè€…å¼‚æ­¥æ•è·` - amazing ğŸ˜± ç¥å¥‡</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å› ä¸º è¿™é‡Œ `promise` çš„éœ€æ±‚å°±æ˜¯ çŠ¶æ€å•ä¸€ ä¸å¯é€†~</span>
  <span class="token comment">// ğŸ“`çŠ¶æ€ä¿æŠ¤` - åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªä¿æŠ¤å°±å¯ä»¥äº†</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="then-çš„åŸºç¡€æ„å»º" tabindex="-1"><code>then</code> çš„åŸºç¡€æ„å»º <a class="header-anchor" href="#then-çš„åŸºç¡€æ„å»º" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™ä¸¤ä¸ªå‡½æ•°æ„å»ºå¥½ä¹‹å å°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¿©å‡½æ•°</span>
  <span class="token comment">// onFulfilled(this.value) // resolve()æ”¹å˜ä¹‹å ç„¶åè·å–åˆ° ä¼ é€’çš„è¿™ä¸ªå€¼</span>
  <span class="token comment">// ä½†æ˜¯å¦‚æœè¿™æ ·å†™ æˆ‘å°±ç®—ä¸ä¼ é€’å€¼ è¿™ä¸ªå€¼å°±æ˜¯ initVal-&gt; null è¿™æ ·æ˜¯ä¸å¯¹çš„  éœ€è¦ç­‰å¾… resolve ä¼ é€’</span>
  <span class="token comment">// æ‰€ä»¥ è¿™ä¸ªonFulfilled æ–¹æ³• ä¸ä¼šè¢«ç«‹å³æ‰§è¡Œ éœ€è¦ç­‰å¾… resolved çš„çŠ¶æ€æ”¹å˜</span>

  <span class="token comment">// åœ¨ `promise` è¿™ä¸¤ä¸ªçŠ¶æ€æ˜¯å¯ä»¥ä¸ä¼ çš„ åªæ˜¯ å ä½ å°±å¯ä»¥äº†ï¼Œå¯ä»¥å•ç‹¬å¤„ç† æˆåŠŸå’Œå¤±è´¥</span>
  <span class="token comment">// ä¹Ÿæ˜¯ å¦‚æœé”™è¯¯çš„æ—¶å€™ å•ç‹¬æ‰§è¡Œ .then çš„ç¬¬ä¸€ä¸ªå‡½æ•° ä¸ä¼šæŠ¥é”™çš„ â¬‡ï¸ æ¥å¤„ç†ä¸€ä¸‹</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœä¸ä¼  æˆ‘ä»¬å°±ç»™ä¸€ä¸ª é»˜è®¤å€¼ å°è£…ä¸€ä¸‹å‡½æ•°</span>
    <span class="token comment">// ğŸ“âš ï¸ ä½†æ˜¯æˆ‘ä»¬çš„ then æ˜¯å¯ä»¥é“¾å¼çš„ æ‰€ä»¥æˆ‘ä»¬è¿™æ ·æ˜¯æœ‰ç‚¹ç‚¹é—®é¢˜çš„</span>
    <span class="token comment">// -return thisæˆ–è€… return è¿™ä¸ª `class` ç±»å</span>
    <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ğŸƒ è¿™æ ·å°±ä¸æŠ¥é”™äº†</span>
    <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ç„¶åå°±éœ€è¦åŠ åˆ¤æ–­</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·" tabindex="-1">å®ç° <code>then</code> çš„ <code>å¼‚æ­¥æ“ä½œ</code> å’Œ <code>å¼‚å¸¸æ•è·</code> <a class="header-anchor" href="#å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·" aria-hidden="true">#</a></h2><ul><li><p>å¦‚æœ åœ¨ <code>then</code> é‡Œé¢çš„æˆåŠŸå›è°ƒå‡½æ•° æœ‰é”™è¯¯äº† é‚£æˆ‘ä»¬åº”è¯¥ å°†å®ƒæ”¾åœ¨ <code>å¤„ç†å¼‚å¸¸</code> é‡Œé¢å»å®Œæˆ</p><div class="language-js"><pre><code><span class="token comment">// ğŸ“âš ï¸ å› ä¸ºåœ¨ åŸç”Ÿ `promise` é‡Œé¢æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸‹</span>
<span class="token comment">// æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å°†æˆ‘ä»¬çš„ä»»åŠ¡ æ”¾ç½®åœ¨ å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ - setTimeout</span>
<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="promise-çš„-pending-çŠ¶æ€å¤„ç†" tabindex="-1"><code>Promise</code> çš„ <code>Pending</code> çŠ¶æ€å¤„ç† <a class="header-anchor" href="#promise-çš„-pending-çŠ¶æ€å¤„ç†" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code> çš„æ—¶å€™ åœ¨åŒæ­¥ä»£ç é‡Œé¢å†™ä¸€ä¸ª <code>setTimeout</code> æ˜¯ç­‰å¾…ä¹‹åå¯ä»¥å‡ºæ¥çš„</p></li><li><p>åœ¨æœ¬æ¬¡å®ç°çš„ ä»£ç é‡Œé¢ å°±å‡ºä¸æ¥äº† åœ¨æœ¬æ¬¡å®ç°ä¸­çš„çŠ¶æ€æ˜¯ <code>pending</code> å› ä¸ºæˆ‘ä»¬çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œ ç„¶ååˆåªåˆ¤æ–­äº† <code>æˆåŠŸå¤±è´¥</code> å¤„ç†</p><div class="language-js"><pre><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨è¿™é‡Œå®šä¸€ä¸ª callback åˆ—è¡¨ ç­‰å¾…æ‰§è¡Œå®Œæˆä¹‹å å†æ‹¿å‡ºæ¥æ‰§è¡Œ</span>
<span class="token punctuation">}</span>

<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¼‚æ­¥å®Œæˆç»“æœä¹‹å æ”¹å˜çŠ¶æ€ å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å› ä¸ºè¿™é‡Œåœ¨ then é‡Œé¢ push è¿›å»çš„æ—¶å€™æ˜¯</span>
    <span class="token comment">// æˆåŠŸå¤±è´¥çŠ¶æ€çš„ key-value</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// if() { ... }</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯pendingçŠ¶æ€</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¤„ç† å‡†å¤‡çŠ¶æ€ å¤„ç†ä¹‹åæ‰§è¡Œçš„å‡½æ•° </span>
    <span class="token comment">// å¦‚æœå¤„äº å‡†å¤‡ çŠ¶æ€çš„æ—¶å€™ é‚£è‚¯å®šä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¸ªæ˜¯å¯ä»¥æ‰“å°å‡ºæ¥çš„</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      onFulfilled<span class="token punctuation">,</span>
      onRejected
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// if() { ... }</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†" tabindex="-1"><code>pending</code> çš„çŠ¶æ€å¼‚å¸¸å¤„ç† <a class="header-anchor" href="#pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†" aria-hidden="true">#</a></h2><ul><li>å¦‚æœåœ¨ pending é‡Œé¢å‡ºç° é”™è¯¯ è¿˜æ˜¯è¦äº¤ç»™ é”™è¯¯æ–¹æ³•æ¥ç»Ÿä¸€è¿›è¡Œå¤„ç†</li></ul><div class="language-js"><pre><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// if() { ... }</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// å› ä¸ºåœ¨ ä¸Šé¢ ä¼ é€’æ¥value å‚æ•°äº†</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// ä¸Šé¢æ˜¯ push çš„å¯¹è±¡å±æ€§ è¿™é‡Œæ˜¯æ‰§è¡Œçš„å‡½æ•°</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// if() { ... }</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§" tabindex="-1"><code>pending</code> çš„å¼‚æ­¥å¤„ç†æŠ€å·§ <a class="header-anchor" href="#pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§" aria-hidden="true">#</a></h2><ul><li>åœ¨ <code>promise</code> çš„åŒæ­¥é‡Œé¢ <code>resolve(&#39;123&#39;)</code> <code>console.log(&#39;223&#39;)</code> é‚£è‚¯å®šæ˜¯å…ˆè¾“å‡ºåŒæ­¥ <code>223</code></li></ul><p>ç„¶å <code>.then</code> å¼‚æ­¥äº† ç„¶åå†è¾“å‡º <code>123</code></p><ul><li><p>åœ¨æˆ‘ä»¬çš„å®ç°ä»£ç é‡Œé¢ <code>resolve()</code> è°ƒç”¨ä¹‹å ä¼šç«‹åˆ»æ‰§è¡Œ æ‰€ä»¥é¡ºåºæ‰§è¡Œäº† â¬‡ï¸ ä¿®æ”¹å¦‚ä¸‹</p><p>å› ä¸ºæˆ‘ä»¬æ”¹å˜ <code>pending</code> - <code>resolve</code> çŠ¶æ€ä¹‹å å›è°ƒç”¨ <code>resolve</code> æ–¹æ³• ç„¶ååœ¨æ‰§è¡ŒæˆåŠŸçš„æ—¶å€™ å˜æˆå¼‚æ­¥ å°±å®Œäº‹äº†</p><div class="language-js"><pre><code><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// ç„¶åå°±ä¼šåœ¨ å¼‚æ­¥ä¹‹å åˆæŠŠè¿™é‡Œçš„å¼‚æ­¥æ”¾åœ¨ä¸»çº¿ç¨‹ ç­‰å¾…æ‰§è¡Œ ç­‰ä¸‹é¢çš„åŒæ­¥æ‰§è¡Œå®Œæˆ ç„¶åå†æ‰§è¡Œ</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="then-é“¾å¼æ“ä½œ" tabindex="-1"><code>then</code> é“¾å¼æ“ä½œ <a class="header-anchor" href="#then-é“¾å¼æ“ä½œ" aria-hidden="true">#</a></h2><ul><li><p><code>new Promise</code> ä¹‹ <code>then</code>çš„é“¾å¼æ“ä½œ åŸç†åˆ†æ</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;æ‹’ç»&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&#39;æˆåŠŸ1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">&#39;å¤±è´¥1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤±è´¥</span>
  <span class="token comment">// âš ï¸ åŸç”Ÿ promise çš„å¤„ç† - ä¸Šé¢æ¥å—å®Œå¤±è´¥ä¹‹å å¤„ç†å®Œå¤±è´¥ä¹‹å ç„¶ååœ¨è¿™é‡Œ `then` ä¼šæ¥æ”¶åˆ°</span>
  <span class="token comment">// å¤±è´¥å¤„ç†å®Œä¹‹åçš„ æ•°æ® - ä¸ä¼šèµ°åˆ° reject é‡Œé¢å»äº†</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>âš ï¸ğŸ“ <code>then</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>promise</code></p></li><li><p>âš ï¸ğŸ“ å¦‚æœä¹‹å‰è¿”å›çš„æ˜¯ æ‹’ç»çš„<code>promise</code> å¹¶ä¸ä¼šå½±å“æˆ‘ä»¬çš„ æ¥ä¸‹æ¥çš„ <code>then</code> æ–°è¿”å›çš„ <code>promise</code></p></li><li><p>âš ï¸ğŸ“ ä¾‹å¦‚ æˆ‘ä»¬ ç¬¬ä¸€ä¸ª <code>then</code> æ¥å—åˆ°å¤±è´¥å¤„ç†å®Œå¤±è´¥ã€‚ <code>return</code> çš„æ˜¯ æˆåŠŸçš„ <code>promise</code></p><div class="language-js"><pre><code><span class="token comment">// å®ç° `promise` çš„é“¾å¼æ“ä½œ</span>
<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™æ · .then()ä¹‹å æˆ‘ä»¬ return new Gl() å°±å¯ä»¥ - æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ å¼‚æ­¥äº†ã€‚</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// éœ€è¦æ”¹å˜çŠ¶æ€ è®©ä¸‹æ¬¡çš„ `then` å’Œ `catch` æ¥è¿›è¡Œæ¥æ”¶</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token comment">// âš ï¸ æˆåŠŸå¤±è´¥ éƒ½ä¸å½±å“ä¸‹æ¬¡ then æ“ä½œ</span>
            <span class="token comment">// æ‰€ä»¥ éƒ½è¦ç”¨ resolve å»æŠ›</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‹’ç»çš„ ç„¶åé”™è¯¯å¤„ç†ä¹‹å å°±æ˜¯é»˜è®¤æ˜¯æˆåŠŸçš„äº†~</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ------------------------------ promise ---------------------------</span>
<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;å¤±è´¥äº†&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&#39;æˆåŠŸ2&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&#39;å¤±è´¥2&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res1&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// res1 å¤±è´¥2 è¿™é‡Œæ¥æ”¶çš„æ˜¯ ä¸Šä¸€ä¸ªå¤±è´¥å¤„ç†å®Œæˆä¹‹åçš„ æˆåŠŸçŠ¶æ€</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ------------------ `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç† -----------------</span>
<span class="token comment">// è§£å†³ ä¸Šä¸€ä¸ª `then` å‘ç”Ÿçš„é”™è¯¯ æˆ‘ä»¬éœ€è¦äº¤ç»™ ä¸‹ä¸€ä¸ª `then` å’Œ `catch` æ¥è¿›è¡Œå¤„ç†</span>
<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸäº†&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŒæ · æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸ throw new Error(&#39;fail&#39;) // æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥æ¥æ”¶åˆ°çš„</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aq<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h2 id="å®ç°-then-çš„-ç©¿é€ä¼ é€’" tabindex="-1">å®ç° <code>then</code> çš„ ç©¿é€ä¼ é€’ <a class="header-anchor" href="#å®ç°-then-çš„-ç©¿é€ä¼ é€’" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸäº†&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="then-è¿”å›-promise-çš„å¤„ç†" tabindex="-1"><code>then</code> è¿”å› <code>promise</code> çš„å¤„ç† <a class="header-anchor" href="#then-è¿”å›-promise-çš„å¤„ç†" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ç„¶ååœ¨ æ‹’ç»çš„æ—¶å€™ è¿”å› `promise` ä¹Ÿå¯ä»¥åœ¨ä¸‹ä¸€æ¬¡ æˆåŠŸçš„æ—¶å€™ æ¥æ”¶åˆ°äº†ï½</span>
      result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token comment">// ç„¶åå¯ä»¥ç®€å†™æˆè¿™ä¸ªæ ·å­</span>
      <span class="token comment">// value =&gt; {</span>
      <span class="token comment">//   resolve(value)</span>
      <span class="token comment">// }, reason =&gt; {</span>
      <span class="token comment">//   reject(reason)</span>
      <span class="token comment">// }</span>
      <span class="token comment">// )</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–" tabindex="-1"><code>then</code> ä»£ç çš„ å†—ä½™ ä¼˜åŒ– <a class="header-anchor" href="#then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token comment">// å°è£…å‡½æ•° - è§£å†³ä»£ç  å†—ä½™</span>
<span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// - è°ƒç”¨ - </span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
</code></pre></div><h2 id="promise-è¿”å›ç±»å‹çš„çº¦æŸ" tabindex="-1"><code>promise</code> è¿”å›ç±»å‹çš„çº¦æŸ <a class="header-anchor" href="#promise-è¿”å›ç±»å‹çš„çº¦æŸ" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è§£å†³&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œé¢ ä¹Ÿæ˜¯å¯ä»¥æ‰“å°åˆ°è¿™ä¸ª p çš„ å› ä¸º .then é‡Œé¢çš„æ˜¯ å¼‚æ­¥åæ‰§è¡Œ</span>
  <span class="token comment">// return p; // ä½†æ˜¯è¿™æ ·æ˜¯ ä¸å¯ä»¥çš„ åœ¨æœ¬èº« js-promise å½“ä¸­ ä¸å…è®¸è¿”å›è‡ªå·±ã€‚</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>åœ¨ <code>return new Gl()</code> æ›´æ”¹å¦‚ä¸‹ã€‚</p><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> promise

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
<span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Chaining cycle detected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul><h2 id="å®ç°-resolve-ä¸-reject" tabindex="-1">å®ç° <code>resolve</code> ä¸ <code>reject</code> <a class="header-anchor" href="#å®ç°-resolve-ä¸-reject" aria-hidden="true">#</a></h2><ul><li><p><code>resolve</code> è¿”å› æ™®é€šå€¼çš„æƒ…å†µ</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p><code>resolve</code> è¿”å› <code>promise</code>å€¼ çš„æƒ…å†µ</p><div class="language-js"><pre><code><span class="token comment">// å…ˆçœ‹ `promise` çš„å¤„ç†</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æˆåŠŸ</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœè¿”å›æˆåŠŸ é‚£then æˆ–è€… then çš„ç¬¬ä¸€ä¸ªå‚æ•° å°±å¯ä»¥æ¥æ”¶åˆ°</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;å¤±è´¥&#39;</span><span class="token punctuation">)</span> <span class="token comment">// å°±éœ€è¦ä½¿ç”¨ catch æˆ–è€… thençš„ç¬¬äºŒä¸ªå‚æ•° å»æ¥æ”¶ã€‚</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// `Promise.resolve` è¿™è¿™é‡Œ å¦‚æœæ¥æ”¶çš„æ˜¯ä¸€ä¸ª promise å€¼çš„è¯ å°±ä¼šæŒ‰ç…§ promise çš„æˆåŠŸå¤±è´¥ å»åšå¯¹åº”çš„å¤„ç†</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// --------------------- æ‰‹å†™ `promise` â¬‡ï¸ ---------------------</span>
<span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="promise-çš„-all-æ–¹æ³•å®ç°" tabindex="-1"><code>promise</code> çš„ <code>All</code> æ–¹æ³•å®ç° <a class="header-anchor" href="#promise-çš„-all-æ–¹æ³•å®ç°" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;éƒ­éœ–&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">valueAll</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>valueAll<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœåˆä¸€ä¸ª å¤±è´¥çŠ¶æ€ é‚£å°±ä¸å¯¹äº†</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>æ‰‹å†™ <code> promise - all</code> æ–¹æ³• â¬‡ï¸</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// all è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª promise ä¸ç„¶æ€ä¹ˆä¼šæœ‰ thenå‘¢</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token parameter">reject</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æˆåŠŸä¸€ä¸ª å°± å‹å…¥ä¸€ä¸ª</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token comment">// ä»»ä½•ä¸€ä¸ªpromiseå¤±è´¥äº† å°±ç”¨æ€»çš„è¿”å›çš„ new Gl - reject æ¥å¯¹é”™è¯¯è¿›è¡Œå¤„ç†</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°" tabindex="-1"><code>promise</code>çš„<code>race</code>çš„é™æ€æ–¹æ³•å®ç° <a class="header-anchor" href="#promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°" aria-hidden="true">#</a></h2><ul><li><p><code>race</code> å‘¢å°±æ˜¯ <code>è°å¿«ç”¨è°çš„</code> - ä¸ç®¡è¿”å›çš„æ˜¯å¤±è´¥è¿˜æ˜¯æˆåŠŸ å¤±è´¥èµ°å¤±è´¥çš„è°ƒç”¨ ç„¶åä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¿”å›å¤±è´¥å å°±ä¸å†è°ƒç”¨äº†</p></li><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// resolve(&#39;p2&#39;)</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;p2 - error&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p2</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœå¤±è´¥çš„æ—¶å€™ å°±éœ€è¦å†™è¿™ä¸ªå‡½æ•°å•¦</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p2 - error</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>æ‰‹å†™ <code>promise - race</code> æ–¹æ³• â¬‡ï¸</p><div class="language-js"><pre><code><span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    promises<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// å› ä¸ºè¿™å—ä¹‹å‰å·²ç»å®šä¹‰äº† promise è¿”å›çŠ¶æ€ æ”¹å˜ä¹‹å å°±ä¸ä¼šå†è¾“å‡ºå€¼äº†</span>
      promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç " tabindex="-1">æœ€å è´´æœ€åå®ç°çš„ <code>å…¨éƒ¨ä»£ç </code> <a class="header-anchor" href="#æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç " aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// console.log(this); // è¿™é‡Œçš„ this ç»™åˆ°äº† new ç»‘å®šçš„</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> 
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
            <span class="token comment">// try {</span>
            <span class="token comment">//   let result = onRejected(reason) // âš ï¸ æˆåŠŸå¤±è´¥ éƒ½ä¸å½±å“ä¸‹æ¬¡ then æ“ä½œ</span>
            <span class="token comment">//   // æ‰€ä»¥ éƒ½è¦ç”¨ resolve å»æŠ›</span>
            <span class="token comment">//   resolve(result);</span>
            <span class="token comment">// } catch (error) {</span>
            <span class="token comment">//   reject(error)</span>
            <span class="token comment">// }</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> result<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Chaining cycle detected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      promises<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/docs/Js/Code" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>Code</span></a></div><div class="next" data-v-e65a9748><a class="link" href="/docs/Js/Copy" data-v-e65a9748><span class="text" data-v-e65a9748>Copy</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-e65a9748><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"docs_js-adv_type.md\":\"206d79d7\",\"docs_js-adv_index.md\":\"94ccfb53\",\"docs_js_array.md\":\"a55ed3ec\",\"docs_js_class.md\":\"9326a368\",\"docs_js_closure.md\":\"ba61e8ba\",\"docs_js_code.md\":\"c5c2a41f\",\"docs_js_codes-promise.md\":\"7b867a41\",\"docs_js_copy.md\":\"bbcdfd55\",\"docs_js_eventloop.md\":\"8d5318af\",\"docs_js_function.md\":\"d4a1510b\",\"docs_js_methods.md\":\"2e6e7579\",\"docs_js_modular.md\":\"87fe8e84\",\"docs_js_object.md\":\"eb4ab063\",\"docs_js_promise.md\":\"adf250c4\",\"docs_js_regexp.md\":\"72fd47d3\",\"docs_js_sub.md\":\"6f87a97b\",\"docs_js_symbol.md\":\"85e8c698\",\"docs_js_index.md\":\"d5c17616\",\"docs_node_api.md\":\"d3a5c47e\",\"docs_node_guide.md\":\"c53ffc15\",\"docs_node_index.md\":\"28fa2c59\",\"docs_vue_base.md\":\"563208fd\",\"docs_vue_component.md\":\"98ce8468\",\"docs_vue_index.md\":\"7772daf7\",\"index.md\":\"0635728a\"}")</script>
    <script type="module" async src="/assets/app.f2ffefc6.js"></script>
    
  </body>
</html>