<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Js - Promise | Cxsuay</title>
    <meta name="description" content="Keep on going never give up">
    <link rel="stylesheet" href="/assets/style.c542bb22.css">
    <link rel="modulepreload" href="/assets/Home.c9153eec.js">
    <link rel="modulepreload" href="/assets/app.f2ffefc6.js">
    <link rel="modulepreload" href="/assets/docs_Js_Promise.md.adf250c4.lean.js">
    <link rel="modulepreload" href="/assets/app.f2ffefc6.js">
    <link rel="icon" href="/favicon.ico">
    <meta name="twitter:title" content="Js - Promise | Cxsuay">
    <meta property="og:title" content="Js - Promise | Cxsuay">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Cxsuay, back to home" data-v-40587210 data-v-7ac13a1e><img class="logo" src="/avatar.jpg" alt="Logo" data-v-7ac13a1e> Cxsuay</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>首页 <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-dropdown-link" data-v-35b91e7e data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>引导</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/docs/Js/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Js-adv/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js-adv</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Node/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Node</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Vue/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Vue</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://gitee.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Gitee(码云) <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/" data-v-49fe041d>首页 <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-dropdown-link" data-v-35b91e7e data-v-18d75f62><button class="button" data-v-18d75f62><span class="button-text" data-v-18d75f62>引导</span><span class="right button-arrow" data-v-18d75f62></span></button><ul class="dialog" data-v-18d75f62><!--[--><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item active" href="/docs/Js/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Js-adv/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Js-adv</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Node/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Node</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><li class="dialog-item" data-v-18d75f62><div class="nav-dropdown-link-item" data-v-18d75f62 data-v-07381bdb><a class="item" href="/docs/Vue/" data-v-07381bdb><span class="arrow" data-v-07381bdb></span><span class="text" data-v-07381bdb>Vue</span><span class="icon" data-v-07381bdb><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://github.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Github <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://gitee.com/cxsuay" target="_blank" rel="noopener noreferrer" data-v-49fe041d>Gitee(码云) <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-17c48e2f><!--[--><li class="sidebar-link"><p class="sidebar-link-item"></p><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js">Js</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Array">Array</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Class">Class</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Closure">Closure</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Code">Code</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Codes-promise">Codes-promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Copy">Copy</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/EventLoop">EventLoop</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Function">Function</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Methods">Methods</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Modular">Modular</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Object">Object</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/docs/Js/Promise">Promise</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#体验异步">体验异步</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-js的任务处理机制">Promise -  js的任务处理机制</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-的状态">promise 的状态</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#js-任务处理机制-其实可以参考-event-loop">js - 任务处理机制 (其实可以参考 - Event Loop)</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#宏任务的提升-原来是误解">宏任务的提升 - 原来是误解</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-的单一状态-和-状态中转">Promise 的单一状态 和 状态中转</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-then-的基本用法">Promise.then() 的基本用法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#其他类型的-promise-封装">其他类型的 Promise 封装</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise的企业级理解-愚见">Promise的企业级理解 - 愚见</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise的错误监测-和-catch的使用">Promise的错误监测 和 catch的使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义错误处理">自定义错误处理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-finally-实现异步加载动画">使用 finally 实现异步加载动画</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-promise-封装">使用 Promise 封装</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#script-脚本中的-promise-加载引擎。">script 脚本中的 Promise 加载引擎。</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-resolve-缓存后台数据">Promise.resolve() - 缓存后台数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-reject-的使用">Promise.reject() 的使用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-all-批量获取数据">Promise.all() 批量获取数据</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-race-这个就是我可以接收多个-promise-但是我只取-最快的一个-promise">Promise.race - 这个就是我可以接收多个 promise 但是我只取 最快的一个 `promise`</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-队列原理">Promise 队列原理</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-map-实现-promise-队列">使用 map 实现 promise 队列</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-reduce-来实现-promise-队列">使用 reduce 来实现 promise 队列</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#使用-promise-队列来渲染数据">使用 promise 队列来渲染数据</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#async-await-语法糖">async-await 语法糖</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#promise-的语法糖-async">promise 的语法糖 async</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#then-的语法糖-await">then 的语法糖  `await</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#async-延时函数">async 延时函数</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#class-与-async-的结合使用">class 与 async 的结合使用</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#async-await-的几种声明方式">async-await 的几种声明方式</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#⚠️🍓-async-await-的错误处理">⚠️🍓 async - await 的错误处理</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#async-的错误处理">`async 的错误处理</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#🍓-不仅要考虑-成功之后数据的处理-更好考虑-出错误的时候的错误处理-保证用户体验和方便代码排错">🍓 不仅要考虑 成功之后数据的处理 更好考虑 出错误的时候的错误处理 保证用户体验和方便代码排错</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#await-的错误处理">await 的错误处理</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#🍓🍌🍉await-并行执行的技巧">🍓🍌🍉await 并行执行的技巧</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/RegExp">RegExp</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Sub">Sub</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js/Symbol">Symbol</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js-adv">Js-adv</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Js-adv/Type">Type</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node">Node</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node/Api">Api</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Node/Guide">Guide</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue">Vue</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue/Base">Base</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/docs/Vue/Component">Component</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="js-promise" tabindex="-1">Js - Promise <a class="header-anchor" href="#js-promise" aria-hidden="true">#</a></h1><h2 id="体验异步" tabindex="-1">体验异步 <a class="header-anchor" href="#体验异步" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// new Image的作用 - https://www.jianshu.com/p/14853aee567b</span>
  <span class="token comment">// 统计网站流量 src属性做请求 new image() 创建图片不增加DOM渲染时间 只发送请求(get)。 | 缓存图片</span>
  <span class="token keyword">let</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loadImg</span><span class="token punctuation">(</span><span class="token string">&#39;https://vxecho.gitee.io/node/logo.png&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;图片加载完了～&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 执行结果如下 ⬇️</span>
<span class="token comment">// 123</span>
<span class="token comment">// 图片加载完了～</span>
</code></pre></div><ul><li><p>异步执行 <code>是先加载先执行的, 没有执行顺序的</code>。</p><p>所以出现了 <code>异步回调 - 回调地狱（callback嵌套）</code> 确保 按顺序加载。</p><p>这个时候 <strong><code>Promise</code></strong> 出现了。 使得代码 更加易懂，然后可以<code>扁平化处理</code></p></li></ul><h2 id="promise-js的任务处理机制" tabindex="-1"><code>Promise</code> - js的任务处理机制 <a class="header-anchor" href="#promise-js的任务处理机制" aria-hidden="true">#</a></h2><h3 id="promise-的状态" tabindex="-1"><code>promise</code> 的状态 <a class="header-anchor" href="#promise-的状态" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token comment">// pending 准备阶段</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;pending&gt;}</span>
<span class="token comment">// resolved 成功 状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;成功状态&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;成功状态&quot;}</span>
<span class="token comment">// rejected 拒绝/失败 状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;失败状态&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;成功状态&quot;}</span>
</code></pre></div><h3 id="js-任务处理机制-其实可以参考-event-loop" tabindex="-1">js - 任务处理机制 (其实可以参考 - <code>Event Loop</code>) <a class="header-anchor" href="#js-任务处理机制-其实可以参考-event-loop" aria-hidden="true">#</a></h3><ul><li><p>奇怪的知识点</p><p>给 <code>setTimeout</code> 设置 <code>0秒</code> 执行。 虽然设置的是0秒，但其实 js 执行的时候是 <code>4ms</code> 执行的</p><ul><li><strong>在 <code>队列{FIFO}</code> 做任务轮询， 先进先出</strong></li></ul></li><li><p><code>同步代码</code> &gt; <code>微任务</code> &gt; <code>宏任务</code></p><p>⚠️ 每次执行 宏任务之前都会将 目前的微任务队列清空执行 然后再执行宏任务</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;这里是同步代码&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ⚠️🍓</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 因为它 返回的是一个 promise 然后下面的 then 会等待执行</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;这里只有上面 resolve 的通知之后 才会执行代码。&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h3 id="宏任务的提升-原来是误解" tabindex="-1">宏任务的提升 - 原来是误解 <a class="header-anchor" href="#宏任务的提升-原来是误解" aria-hidden="true">#</a></h3><ul><li><p>同步代码执行完成之后。会将 <code>异步</code> 放入到主线程执行。</p><p><strong>⚠️ 此刻的在主线程代码 可以把它当作 正常机制处理 - 然后就各种循环这种机制调用了 - <code>Event Loop</code></strong></p><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ⚠️ 这里 setTimeout 已经拿到主线程来执行了。 所以 现在是主线程代码</span>
    <span class="token comment">// 必须把 主线程里面代码执行完成之后 才能去只执行 微任务和宏任务</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 然后执行 微任务里面的 异步代码 - 下次执行会把它放置在主线程上</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;setTimeout&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ⚠️ 异步放在主线程里面 这里已经是同步代码了~</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;promise&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;成功&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;guolin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 同步</span>
<span class="token comment">// promise</span>
<span class="token comment">// guolin</span>
<span class="token comment">// setTimeout</span>
<span class="token comment">// 成功</span>
</code></pre></div></li></ul><h2 id="promise-的单一状态-和-状态中转" tabindex="-1"><code>Promise</code> 的单一状态 和 状态中转 <a class="header-anchor" href="#promise-的单一状态-和-状态中转" aria-hidden="true">#</a></h2><ul><li><p><code>Promise</code> 的状态改变之后，就会触发后面的事件。</p><p>所以 <strong><code>Promise</code>状态是单一 而且 不可逆的</strong></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;成功&#39;</span><span class="token punctuation">)</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;失败&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// promise 状态改变之后是不可逆的 如果返回了成功 然后下面是失败 是无效的</span>
  <span class="token comment">// 只要 状态改变 后面就触发了状态 所以promise 状态是单一的不可逆的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// p1 此刻是一个 promise</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个成功的promise 然后肯定走的 then</span>
  <span class="token comment">// 如果 上面是 reject 那么p1 此刻是一个失败的promise类型的的结果 也会走 catch</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;then&#39;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// then 成功</span>
</code></pre></div></li></ul><h2 id="promise-then-的基本用法" tabindex="-1"><code>Promise.then()</code> 的基本用法 <a class="header-anchor" href="#promise-then-的基本用法" aria-hidden="true">#</a></h2><ul><li><code>Promise.then()</code> 返回的是 一个 <code>promise</code></li></ul><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;错误&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果只关注失败前面是需要有的 随便填一个值即可</span>
  <span class="token comment">// throw new Error(&#39;这样呢 接收什么&#39;) // 如果抛出错误在前 那么就相当于改变了 promise 的状态 所以会走catch</span>
  <span class="token keyword">return</span> <span class="token string">&#39;1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里又接收了一个1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err1&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>如果<code>promise.then</code>(这里呢什么也没有处理那么我们就会一直往后走)<code>.then</code>(这里也是可以处理上一个返回结果的)</p><p><strong>不过 一般不这么写 ✨✨✨</strong></p><p>如果 第一个 <code>then</code> 不返回值，第二个<code>then</code> 也是会执行，只是 如果不返回值，接下来的<code>then</code>接收不到。</p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;哈哈&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;reason&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">// console.log(&#39;p1&#39;, p1); // p1 Promise {&lt;resolved&gt;: &quot;哈哈&quot;} - 成功状态</span>
<span class="token comment">// console.log(&#39;p2&#39;, p2); // p2 Promise {&lt;pending&gt;} - 等待状态</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这样的结果就是 &#39;value 哈哈&#39; - &#39;1&#39; - p1 - p2</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p1 Promise {&lt;resolved&gt;: &quot;哈哈&quot;} - 成功状态</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;p2&#39;</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ⚠️ 此时 由于微任务已经.then了 </span>
  <span class="token comment">// 而且宏任务执行要清空目前已存在的微任务  所以这时p2的状态 - p2 Promise {&lt;resolved&gt;: undefined}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// resolve(&#39;哈哈&#39;);</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;😂哈哈哈&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变一下子</span>
<span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;reason&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">let</span> p3 <span class="token operator">=</span> p2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">a</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 这里的这个 处理是对 上一个promise 状态结果的处理</span>
  <span class="token comment">// 无论成功失败 都跟我这个 promise 没有关系了 我只接受一个结果</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;成功&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;失败&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// p1 - p3 - reason 😂哈哈哈 - promise.js:144 成功</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span> <span class="token comment">// 此时打印 p1 就是 p1 Promise {&lt;rejected&gt;: &quot;😂哈哈哈&quot;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;p3&#39;</span><span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p3 Promise {&lt;pending&gt;} 此刻的p3 又是 peding 状态</span>
</code></pre></div></li><li><p><code>then</code>返回值的处理技巧</p><ul><li><p>基础</p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;第一个成功&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// reject(&#39;第一个失败&#39;)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;字符串&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;失败的字符串&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果p1返回的是 resolve 那么此刻的值就是 res 字符串</span>
  <span class="token comment">// 如果p1返回的是 reject 那么此刻的值就是 res 失败的字符串</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p>如果 return 的是 <code>promise</code> 那就会根据 <code>promise</code> 返回的状态来做相对应的处理</p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;第一个成功&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve(&#39;第一个成功&#39;)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;第一个失败&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;失败的字符串&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果 上面 return 的是 promise 那就会根据 promise 返回的状态来做相对应的处理</span>
  <span class="token comment">// ⚠️ 其实很简单 就是如果返回的是 promise 的话 我就相当于 init了 然后根据 成功 失败 来做判断</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果上面 返回的是 resolve 那么此刻的值就是 res 第一个成功</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果上面 返回的是 resolve 那么此刻的值就是 err 第一个失败</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>然后需要注意 <code>链式.then</code> 需要上一个 <code>then</code>方法 <code>return</code> 出来我们才能对其处理</li><li>如果不 <code>return</code> 那我们 <code>then</code> 就是对上一个 <code>then</code> 返回的 <code>promise</code> 进行处理</li><li>推荐 如果下面有要<code>.then</code>的链式操作 最好 <code>return</code> 或者 返回 <code>promise</code> 来进行处理</li></ul></li><li><p><strong>进阶-加深理解 <code>.then(Promse.then()).then</code> 处理</strong></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;第一个成功&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// resolve(&#39;第一个成功&#39;)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;第一个失败&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;r&#39;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span> 
      <span class="token keyword">return</span> <span class="token string">&#39;222&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&#39;失败的字符串&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 这里 return new Promise.then 了之后 那就会紧接着对其进行处理</span>
<span class="token comment">// 然后 最下面的 then 是对 return new Promise.then(这里面返回值的一个处理)</span>
<span class="token comment">// console.log(&#39;r&#39;, r);  之后不 return 就是下面这个结果</span>
<span class="token comment">// r 第一个失败</span>
<span class="token comment">// res undefined</span>

<span class="token comment">// console.log(&#39;r&#39;, r);  之后 返回 return &#39;222&#39; 则是下面的结果</span>
<span class="token comment">// r 第一个失败</span>
<span class="token comment">// res 222</span>
</code></pre></div><ul><li>总之要记得<code>return</code> 后面的<code>.then()</code> 就是对前面的 <code>return</code> 的处理，如果<code>return </code>的是 <code>promise</code> 那则是会根据状态返回 来进行操作。</li></ul></li></ul></li></ul><h2 id="其他类型的-promise-封装" tabindex="-1">其他类型的 <code>Promise</code> 封装 <a class="header-anchor" href="#其他类型的-promise-封装" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;第一个成功&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// return { name: &#39;123&#39; } // 如果返回的是一个普通对象 那下面 then 接收的就是一个普通对象 </span>
    <span class="token comment">// return { // 如果 返回的是 then方法 这时候的then 就会被封装成 promise 然后下面接收</span>
    <span class="token comment">//   then(resolve, reject) {</span>
    <span class="token comment">//     resolve(&#39;这是个对象&#39;)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
    <span class="token comment">// class Gl {</span>
    <span class="token comment">//   then(resolve, reject) {</span>
    <span class="token comment">//     resolve(&#39;我是 class 里面的then方法&#39;)</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// }</span>
    <span class="token comment">// return new Gl(); // 因为 new 出来的实例对象里面 有then 方法 所以就会被接收到</span>
    <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token punctuation">{</span> <span class="token comment">// 返回的 class 里 有静态的 then 方法 所以也会被接收到 </span>
      <span class="token keyword">static</span> <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;我是 class 里面的then方法&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 对应返回 普通对象 时候的打印 - value {name: &quot;123&quot;}</span>
    <span class="token comment">// 对应返回 对象里面 特殊的方法 then 的时候的打印 - value 这是个对象</span>
    <span class="token comment">// 对应返回 new class 里面有then方法 的时候打印 - value 我是 class 里面的then方法</span>
    <span class="token comment">// 对应返回 class 里面有 静态的then方法 的时候打印 - value 我是 class 里面的静态方法</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// ⚠️注意： 最下面的then 接收的时候 会检查 类呀或者对象呀 里面有没有 then 方法 然后会直接调用</span>
  <span class="token comment">// 但是需要 以 promise 的形式返回 然后才会被接收到  如果 不返回状态 那也会执行 上面 then 方法里面的代码</span>
</code></pre></div><h2 id="promise的企业级理解-愚见" tabindex="-1"><code>Promise</code>的企业级理解 - 愚见 <a class="header-anchor" href="#promise的企业级理解-愚见" aria-hidden="true">#</a></h2><ul><li><p>🍓 突然想起 我们接收的后台参数 不就是在 <code>axios</code> 里面拦截器 统一返回成<code>promise</code>然后再处理的吗 - <code>return Promise.resolve(结果)</code></p></li><li><p>😱 <code>amazing</code> 神奇</p></li><li><p>💦 不过好像 <code>axios</code> 返回的就是 <code>promise</code> 哈哈哈 虽然但是 还是要封装一下的 - 但是可以对 <code>ajax</code> 啥的进行封装 使用 <code>.then</code></p></li><li><p>针对与 之前的 回调地狱 各种嵌套</p><ul><li><p>如果有 一个协议需要上一个协议 请求后的结果的时候 就最好是 扁平化调用一下</p><p><code>.then(value =&gt; axios(协议请求 - 取第一个协议返回的结果)).then(value =&gt; 第二个协议做处理)</code></p></li></ul></li></ul><h2 id="promise的错误监测-和-catch的使用" tabindex="-1"><code>Promise</code>的错误监测 和 <code>catch</code>的使用 <a class="header-anchor" href="#promise的错误监测-和-catch的使用" aria-hidden="true">#</a></h2><ul><li><code>reject(&#39;错误1&#39;)</code> - 基础的</li><li><code>reject(new Error(&#39;错误1&#39;))</code> - 自己 <code>new </code> 一个错误类型</li><li><code>throw new Error(&#39;fail&#39;)</code> - 自己抛出错误类型也是可以的</li><li><code>gl + 1 </code> - 不明变量 也会被 catch 或者 err 接收到`</li></ul><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;错误1&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 基础的</span>
  <span class="token comment">// ⚠️ 相当于 内部 做了一个 try {} catch (error) {} 监测</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>✨✨✨<strong>如果多个<code> .then</code> 调用的话 处理错误 其实就是 最后调用一下 <code>catch</code> 就可以</strong><ul><li>多个 <code> .then</code> 链式调用 可以每个都写 <code>catch</code> 来捕获 也可以 最后调用 <code>catch</code> 来做统一处理</li><li>推荐 最后写 catch 来做统一捕获 <ul><li>因为如果连续两个 catch 第二个只会捕获临近没有 错误处理的代码 不会操作已经有错误处理的代码了</li><li>如果 catch 之前 没有错误处理 那就都会走 catch 来进行错误处理</li><li>如果 catch 之前 有错误处理的回调， 那就走 临近的 下一个进行错误处理 并 之后的错误处理不会捕获 之前的错误处理</li></ul></li></ul></li></ul><h2 id="自定义错误处理" tabindex="-1">自定义错误处理 <a class="header-anchor" href="#自定义错误处理" aria-hidden="true">#</a></h2><ul><li><p>继承了 Error 之后 就可以使用 先对应的错误处理了</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">paramError</span> <span class="token keyword">extends</span> <span class="token class-name">Error</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;paramError&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印的时候 因为 new Error 是对象 然后 可以 打印 new Error().message 来进行 错误消息 提示</span>
<span class="token comment">//  神奇 ⚠️ -  也可以在错误处理的时候 进行  instanceof 判断 </span>
<span class="token comment">// 返回 reject(new ParamError(&#39;参数错误&#39;))</span>
<span class="token comment">// 然后 前端 catch 的时候 判断 if (err instanceof paramError) { ...然后做相对应的处理 }</span>
</code></pre></div></li></ul><h2 id="使用-finally-实现异步加载动画" tabindex="-1">使用 <code>finally</code> 实现异步加载动画 <a class="header-anchor" href="#使用-finally-实现异步加载动画" aria-hidden="true">#</a></h2><ul><li><p><code>finally</code>无论成功还是失败的时候 始终会执行(只要执行完成)</p><p>可以用来做 加载动画 的，不关心成功失败 只要完成就可以结束动画</p><div class="language-"><pre><code>.then() &amp; .catch() &amp; .finally
</code></pre></div></li><li><p>🍓⚠️🍃 <strong>奇怪的知识</strong></p><p><strong>html里面 标示 id 的标签 可以在 js 里面直接使用</strong></p><div class="language-jsx"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
id1<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&#39;1&#39;</span> <span class="token comment">// 是可以 input 进去的</span>
</code></pre></div></li></ul><h2 id="使用-promise-封装" tabindex="-1">使用 <code>Promise</code> 封装 <a class="header-anchor" href="#使用-promise-封装" aria-hidden="true">#</a></h2><ul><li><p>异步加载图片</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    image<span class="token punctuation">.</span>src <span class="token operator">=</span> src<span class="token punctuation">;</span>
    image<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    image<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">loadImage</span><span class="token punctuation">(</span><span class="token string">&#39;...url&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;reason&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p><code>setTimeout</code> 定时器</p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">timeout</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;哈哈哈&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;如果不返回 第二个 then 还是会执行的&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 只是接受不到值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 打印如下 ⬇️</span>
<span class="token comment">// 哈哈哈</span>
<span class="token comment">// 如果不返回 第二个 then 还是会执行的</span>
</code></pre></div></li><li><p>构建 扁平化的 <code>setInterval</code></p><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这块拿的就是 Promise().resolve() 然后上面 return promise 所以 2 这个结果 下面 .then 是可以接收到的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 竟然打印了...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h2 id="script-脚本中的-promise-加载引擎。" tabindex="-1"><code>script</code> 脚本中的 <code>Promise</code> 加载引擎。 <a class="header-anchor" href="#script-脚本中的-promise-加载引擎。" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token comment">// 不推荐这样写 ❌</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// tag:1</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这里的 .then 接受的是 tag:1 里面的 .then()</span>
<span class="token comment">// 推荐这样写 ✅</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 推荐这样写 这样和 tag:1 的结果类似</span>
</code></pre></div><h2 id="promise-resolve-缓存后台数据" tabindex="-1"><code>Promise.resolve()</code> - 缓存后台数据 <a class="header-anchor" href="#promise-resolve-缓存后台数据" aria-hidden="true">#</a></h2><div class="language-js"><pre><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;哈哈哈&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;哈哈哈&quot;} - 成功状态</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;哈哈哈&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 这样写 默认就是成功 的</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 哈哈哈</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 一样的数据 - 存下缓存 - 防止重复请求</span>
<span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 函数本来也是对象 可以往里面 压属性</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> query<span class="token punctuation">.</span>cache <span class="token operator">||</span> <span class="token punctuation">(</span>query<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;🍓走缓存了&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token string">&#39;...url&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      cache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> res<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;没有走缓存&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p><code>Promise.resolve</code>手写类似代码</p><div class="language-js"><pre><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">gl</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Promise<span class="token punctuation">.</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token string">&#39;郭霖&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: &quot;郭霖&quot;}</span>
</code></pre></div></li></ul><h2 id="promise-reject-的使用" tabindex="-1"><code>Promise.reject()</code> 的使用 <a class="header-anchor" href="#promise-reject-的使用" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token comment">// 对象里面 包括 then 方法 这样也是可以调用的</span>
<span class="token keyword">let</span> gl <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;郭霖&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>gl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 会自动寻找对象里的 then 方法 然后进行调用</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 郭霖</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;郭霖&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token string">&#39;成功&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// throw new Error(&#39;fail&#39;) // 可以这么写</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;参数错误&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 也可以这么写 这里需要写 return 需要接受 promise还是value值类型</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;reason&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span> <span class="token comment">// reason Error: fail</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="promise-all-批量获取数据" tabindex="-1"><code>Promise.all()</code> 批量获取数据 <a class="header-anchor" href="#promise-all-批量获取数据" aria-hidden="true">#</a></h2><ul><li><p>需要所有都返回成功 <code>all</code> 才会成功 如果有一项失败了那 <code>all</code> 就整体失败了~</p><div class="language-js"><pre><code>Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ⚠️ 这里如果 p1 p2 没有对其进行处理，在 all里面 是可以统一处理的</span>
 <span class="token comment">// ⚠️ 如果其中一项 例如-p1-已经做出了处理 那么就已经是解决状态 然后然后没有继续 return 那就接受的就是 undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// `Promise.all()` 是需要 所有都返回成功之后 才会成功。</span>
<span class="token comment">// `promise.allSettled()` 是成功 失败都可以 都会给保存下来。 </span>
<span class="token comment">//    如果 失败了 也会保存下来 然后都会走 `.then` 只不过 成功和失败 返回的状态不同 判断 status === &#39;fulfilled&#39; 成功的~</span>
<span class="token comment">// 返回来的结构就是 { status: 状态, value: 返回来的值 }</span>
</code></pre></div></li></ul><h2 id="promise-race-这个就是我可以接收多个-promise-但是我只取-最快的一个-promise" tabindex="-1"><code>Promise.race</code> - 这个就是我可以接收多个 <code>promise</code> 但是我只取 <strong>最快的一个 <code>promise</code></strong> <a class="header-anchor" href="#promise-race-这个就是我可以接收多个-promise-但是我只取-最快的一个-promise" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token comment">// 后台请求超时处理 - 封装一下 </span>
<span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">2000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment">// axios(url),</span>
    <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;请求超时&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&#39;www.//...&#39;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="promise-队列原理" tabindex="-1"><code>Promise</code> 队列原理 <a class="header-anchor" href="#promise-队列原理" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 是 依次执行的  然后等上一个状态返回才会执行下一个 then 和 promise 的</span>
<span class="token comment">// 原理就是 队列中的每一个成员都是 promise 然后下一个需要等上一个的状态改变。</span>
</code></pre></div><h3 id="使用-map-实现-promise-队列" tabindex="-1">使用 <code>map</code> 实现 <code>promise</code> 队列 <a class="header-anchor" href="#使用-map-实现-promise-队列" aria-hidden="true">#</a></h3><ul><li><strong>总之就是 每次 赋值给 promise 变量， 因为每次 then 执行下一次都获取到上一次 promise 返回的结果</strong></li></ul><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  num<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// ⚠️ 这块是主要的 promise 每次都赋值 然后一次队列调用</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 改变状态之后 结合定时器 就可以实现 依次打印了</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 总之就是 每次 赋值给 promise 变量， 因为每次 then 执行下一次都获取到上一次 promise 返回的结果</span>
<span class="token comment">// setTimeout 只是模拟 api调用的时耗。 然后每次都1秒后 返回状态 然后下个then 接收到 接着执行</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里参数 可以换成 promise 数组 然后就可以实现 多个promise 依次执行的功效了</span>
</code></pre></div><h3 id="使用-reduce-来实现-promise-队列" tabindex="-1">使用 <code>reduce</code> 来实现 <code>promise</code> 队列 <a class="header-anchor" href="#使用-reduce-来实现-promise-队列" aria-hidden="true">#</a></h3><ul><li>保证 <code>then</code> 是连续的， 每次的 <code>promise</code> 又是一个新的 <code>promise</code> 就可以了</li></ul><div class="language-js"><pre><code><span class="token keyword">function</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 这块每次返回 就是一个 新的 new Promise() 对象</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="使用-promise-队列来渲染数据" tabindex="-1">使用 <code>promise</code> 队列来渲染数据 <a class="header-anchor" href="#使用-promise-队列来渲染数据" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token comment">// eg: </span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 请求数据的方法</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">users</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    users<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> user</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">_</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token comment">// 这块是封装的ajax方法然后是返回数据的方法</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 这块是 自动将数据渲染到页面 获取一个 渲染一个的意思</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">view</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">view</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 渲染页面的方法</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;params-eg&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="async-await-语法糖" tabindex="-1"><code>async-await</code> 语法糖 <a class="header-anchor" href="#async-await-语法糖" aria-hidden="true">#</a></h2><ul><li><p>⚠️ await 必须要在 async 声明的函数中才可以生效 不然会报错</p></li><li><p><strong><code>async 函数</code> 这个就相当于 我们 <code>new Promise()</code> 的做法</strong></p></li><li><p><strong><code>await promise</code> 这个就相当于 我们 <code>.then()</code> 的做法</strong></p><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span> <span class="token comment">// 这个就相当于 我们 new Promise() 的做法</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: undefined} ⚠️ - 这里的 promise 状态是已解决的状态async function gl() {</span>
<span class="token punctuation">}</span> <span class="token comment">// 这个就相当于 我们 new Promise() 的做法</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved&gt;: undefined} ⚠️ - 这里的 promise 状态是已解决的状态</span>
</code></pre></div></li></ul><h3 id="promise-的语法糖-async" tabindex="-1"><code>promise</code> 的语法糖 <code>async</code> <a class="header-anchor" href="#promise-的语法糖-async" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;guolin&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// guolin</span>
</code></pre></div><h3 id="then-的语法糖-await" tabindex="-1"><code>then</code> 的语法糖 `await <a class="header-anchor" href="#then-的语法糖-await" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// let name = await &#39;guolin&#39;; // 这里相当于 Promise.resolve(&#39;guolin&#39;) 但这里是 promise的 类型</span>
  <span class="token comment">// console.log(name); // guolin</span>

  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// await 就是 then 的简写</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;guolin&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 如果不改变状态 resolve 那就永远无法 输入 name 一直在等待</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// guolin</span>
  <span class="token comment">// await 其实就是 避免频繁的 new Promise() 的写法</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="async-延时函数" tabindex="-1"><code>async</code> 延时函数 <a class="header-anchor" href="#async-延时函数" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">slepp</span><span class="token punctuation">(</span><span class="token parameter">delay <span class="token operator">=</span> <span class="token number">2000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> user <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token string">&#39;g&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;l&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">slepp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 因为这里在等 promise 的状态改变 2秒后改变 然后输出内容</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每隔两秒 打印 g 然后 l</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="class-与-async-的结合使用" tabindex="-1"><code>class</code> 与 <code>async</code> 的结合使用 <a class="header-anchor" href="#class-与-async-的结合使用" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果一个类中 包含有一个 then 方法 </span>
    <span class="token comment">// 那在于 promise 使用的时候 就会包装成一个 promise 的then方法</span>
    <span class="token comment">// resolve();</span>

    <span class="token comment">// 如果里面有 异步调用操作方法 那么即使调用完了下面也不会打印</span>
    <span class="token comment">// 需要 改变一下状态， 如果有需要使用的值 传递就可以了</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 然后改变状态之后 下面await 就会释放执行了</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;guolin&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果 User里面的 then 方法 没有返回状态 后面的 打印是不会执行的</span>
  <span class="token comment">// await 会等待 promise 返回的状态之后才打印</span>
<span class="token punctuation">}</span>
<span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>异步封装在类的 内部</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
  <span class="token comment">// get(name) {</span>
  <span class="token comment">//   let user = ajax(`请求调用的api`);</span>
  <span class="token comment">//   user.name += &#39;-guolin&#39;；</span>
  <span class="token comment">//   console.log(user); // 这里这样写 异步了 然后 user.name很有可能是 undefined </span>
  <span class="token comment">//   return user;</span>
  <span class="token comment">// }</span>

  <span class="token comment">// 使用 then 也行 async await 更好更直观</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">请求调用的api</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样就保证执行了 同步了</span>
    user<span class="token punctuation">.</span>name <span class="token operator">+=</span> <span class="token string">&#39;-guolin&#39;</span>；
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;guolin1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// await 就是 then 的语法糖</span>
  <span class="token comment">// 这里的 then 就可以接收到 上面的 return 的结果了</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h2 id="async-await-的几种声明方式" tabindex="-1"><code>async-await</code> 的几种声明方式 <a class="header-anchor" href="#async-await-的几种声明方式" aria-hidden="true">#</a></h2><ul><li><p><code>async function get() { await ... }</code> - 函数声明</p></li><li><p><code>let get = async function() { await ... }</code> - 函数表达式的声明</p></li><li><p>对象声明</p><div class="language-js"><pre><code><span class="token keyword">let</span> gl <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 对象声明</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
gl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div></li><li><p><code>class</code> 声明</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span> <span class="token comment">// class 声明</span>
  <span class="token keyword">async</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">await</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h2 id="⚠️🍓-async-await-的错误处理" tabindex="-1">⚠️🍓 <code>async - await</code> 的错误处理 <a class="header-anchor" href="#⚠️🍓-async-await-的错误处理" aria-hidden="true">#</a></h2><h3 id="async-的错误处理" tabindex="-1">``async` 的错误处理 <a class="header-anchor" href="#async-的错误处理" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 普通 promise 的错误处理</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;fail&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ⚠️🍓 这里的 catch 除了 捕获协议上的错误 </span>
  <span class="token comment">// 🍓 也会捕获 代码里面发生的错误 相当于 内部隐形的一个 try catch</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: fail</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// throw new Error(&#39;fail&#39;) // 自己抛出的也会处理</span>
<span class="token punctuation">}</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 因为 async 是 promise 语法糖 这样也是可以对错误进行处理的</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: a is not defined</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 也是可以捕获到 api协议 的错误的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="🍓-不仅要考虑-成功之后数据的处理-更好考虑-出错误的时候的错误处理-保证用户体验和方便代码排错" tabindex="-1">🍓 不仅要考虑 成功之后数据的处理 更好考虑 出错误的时候的错误处理 保证用户体验和方便代码排错 <a class="header-anchor" href="#🍓-不仅要考虑-成功之后数据的处理-更好考虑-出错误的时候的错误处理-保证用户体验和方便代码排错" aria-hidden="true">#</a></h3><h3 id="await-的错误处理" tabindex="-1"><code>await</code> 的错误处理 <a class="header-anchor" href="#await-的错误处理" aria-hidden="true">#</a></h3><ul><li><p>单个错误处理</p><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// await 后面一般情况下 也跟的是个 promise</span>
  <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在外面进行的 错误处理</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span>成功的处理<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这样也是可以对 await 接收到的错误 进行处理的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在内部进行的 错误处理 try catch</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// try里面的代码报错的时候,catch里面的代码才会执行,finally里面的代码永远会执行</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;111&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果上面的异步错误了 这里是打印不到的 因为会阻断</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 可以在这块进行错误处理</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span> <span class="token comment">// 无论有无异常里面代码都会执行</span>
    <span class="token comment">// ...这里是 try catch 之后 都会调用代码  也可以写在这里</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ⚠️ 如果 处理完错误了之后</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;222&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在这里是 就可以打印到了</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>如果是 多个异步 的情况下</p><div class="language-js"><pre><code><span class="token comment">// 把多个 统一放置到 try catch 里面</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> user1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">ajax</span><span class="token punctuation">(</span>url<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里 无论谁发生错误 catch 都会接收到</span>
<span class="token punctuation">}</span>
<span class="token comment">// 也可以都放在 外面进行处理</span>
<span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里也可以接收到 里面的错误</span>
  <span class="token comment">// 但是 你需要返回 await 的数据 因为... await 是 then 的语法糖 相当于 then 操作</span>
  <span class="token comment">// 之前 promise.then 如果有错误 最后统一处理也是可以的</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul><h2 id="🍓🍌🍉await-并行执行的技巧" tabindex="-1">🍓🍌🍉<code>await</code> 并行执行的技巧 <a class="header-anchor" href="#🍓🍌🍉await-并行执行的技巧" aria-hidden="true">#</a></h2><ul><li><p>正常情况下 <code>await</code> 下面代码都需要等待 <code>await</code> 返回之后才可以被执行</p><div class="language-js"><pre><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ⚠️ p1 p2 都是 异步</span>
  <span class="token comment">// let h1 = await p1;</span>
  <span class="token comment">// console.log(h1);</span>
  <span class="token comment">// let h2 = await p2;</span>
  <span class="token comment">// console.log(h2);</span>
  <span class="token comment">// // 这里这样写 就是 等待p1执行 然后p2执行</span>

  <span class="token comment">// 方法1 - 达到并行 - 限制性 最后等待结果 然后 实现并行执行的效果</span>
  <span class="token keyword">let</span> h1 <span class="token operator">=</span> p1<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> h2 <span class="token operator">=</span> p2<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 这里就是 p1 p2 是在同时执行 只不过是比较 自身执行快慢的问题</span>
  <span class="token comment">// 然后在下面执行 await 因为上面已经在执行了</span>
  <span class="token keyword">let</span> h1Value <span class="token operator">=</span> <span class="token keyword">await</span> h1<span class="token punctuation">;</span> <span class="token comment">// await 是当作 then 来执行的</span>
  <span class="token keyword">let</span> h2Value <span class="token operator">=</span> <span class="token keyword">await</span> h2<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>h1Value<span class="token punctuation">,</span> h2Value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里就看到 h1 h2 同时执行了 amazing 😱 神奇</span>

  <span class="token comment">// 方法2 - Promise.all() = 达到并行</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里 也可以同时接收到结果</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><div class="next-and-prev-link" data-v-8fcebc32 data-v-e65a9748><div class="container" data-v-e65a9748><div class="prev" data-v-e65a9748><a class="link" href="/docs/Js/Object" data-v-e65a9748><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-e65a9748><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-e65a9748>Object</span></a></div><div class="next" data-v-e65a9748><a class="link" href="/docs/Js/RegExp" data-v-e65a9748><span class="text" data-v-e65a9748>RegExp</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-e65a9748><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"docs_js-adv_type.md\":\"206d79d7\",\"docs_js-adv_index.md\":\"94ccfb53\",\"docs_js_array.md\":\"a55ed3ec\",\"docs_js_class.md\":\"9326a368\",\"docs_js_closure.md\":\"ba61e8ba\",\"docs_js_code.md\":\"c5c2a41f\",\"docs_js_codes-promise.md\":\"7b867a41\",\"docs_js_copy.md\":\"bbcdfd55\",\"docs_js_eventloop.md\":\"8d5318af\",\"docs_js_function.md\":\"d4a1510b\",\"docs_js_methods.md\":\"2e6e7579\",\"docs_js_modular.md\":\"87fe8e84\",\"docs_js_object.md\":\"eb4ab063\",\"docs_js_promise.md\":\"adf250c4\",\"docs_js_regexp.md\":\"72fd47d3\",\"docs_js_sub.md\":\"6f87a97b\",\"docs_js_symbol.md\":\"85e8c698\",\"docs_js_index.md\":\"d5c17616\",\"docs_node_api.md\":\"d3a5c47e\",\"docs_node_guide.md\":\"c53ffc15\",\"docs_node_index.md\":\"28fa2c59\",\"docs_vue_base.md\":\"563208fd\",\"docs_vue_component.md\":\"98ce8468\",\"docs_vue_index.md\":\"7772daf7\",\"index.md\":\"0635728a\"}")</script>
    <script type="module" async src="/assets/app.f2ffefc6.js"></script>
    
  </body>
</html>