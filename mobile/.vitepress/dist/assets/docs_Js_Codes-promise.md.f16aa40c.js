import{_ as n,c as s,o as a,a as p}from"./app.9a3fef87.js";const t='{"title":"Js - æ‰‹æ’¸ Prmoise - ç®€æ˜“ç‰ˆæœ¬","description":"","frontmatter":{},"headers":[{"level":2,"title":"å£°æ˜ Promise å¹¶ç»‘å®š this","slug":"å£°æ˜-promise-å¹¶ç»‘å®š-this"},{"level":2,"title":"çŠ¶æ€ä¿æŠ¤ ä¸ æ‰§è¡Œè€…å¼‚æ­¥æ•è·","slug":"çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·"},{"level":2,"title":"then çš„åŸºç¡€æ„å»º","slug":"then-çš„åŸºç¡€æ„å»º"},{"level":2,"title":"å®ç° then çš„ å¼‚æ­¥æ“ä½œ å’Œ å¼‚å¸¸æ•è·","slug":"å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·"},{"level":2,"title":"Promise çš„ Pending çŠ¶æ€å¤„ç†","slug":"promise-çš„-pending-çŠ¶æ€å¤„ç†"},{"level":2,"title":"pending çš„çŠ¶æ€å¼‚å¸¸å¤„ç†","slug":"pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†"},{"level":2,"title":"pending çš„å¼‚æ­¥å¤„ç†æŠ€å·§","slug":"pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§"},{"level":2,"title":"then é“¾å¼æ“ä½œ","slug":"then-é“¾å¼æ“ä½œ"},{"level":2,"title":"å®ç° then çš„ ç©¿é€ä¼ é€’","slug":"å®ç°-then-çš„-ç©¿é€ä¼ é€’"},{"level":2,"title":"then è¿”å› promise çš„å¤„ç†","slug":"then-è¿”å›-promise-çš„å¤„ç†"},{"level":2,"title":"then ä»£ç çš„ å†—ä½™ ä¼˜åŒ–","slug":"then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–"},{"level":2,"title":"promise è¿”å›ç±»å‹çš„çº¦æŸ","slug":"promise-è¿”å›ç±»å‹çš„çº¦æŸ"},{"level":2,"title":"å®ç° resolve ä¸ reject","slug":"å®ç°-resolve-ä¸-reject"},{"level":2,"title":"promise çš„ All æ–¹æ³•å®ç°","slug":"promise-çš„-all-æ–¹æ³•å®ç°"},{"level":2,"title":"promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°","slug":"promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°"},{"level":2,"title":"æœ€å è´´æœ€åå®ç°çš„ å…¨éƒ¨ä»£ç ","slug":"æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç "}],"relativePath":"docs/Js/Codes-promise.md","lastUpdated":1632732114000}',o={},e=[p('<h1 id="js-æ‰‹æ’¸-prmoise-ç®€æ˜“ç‰ˆæœ¬" tabindex="-1">Js - æ‰‹æ’¸ <code>Prmoise</code> - ç®€æ˜“ç‰ˆæœ¬ <a class="header-anchor" href="#js-æ‰‹æ’¸-prmoise-ç®€æ˜“ç‰ˆæœ¬" aria-hidden="true">#</a></h1><h2 id="å£°æ˜-promise-å¹¶ç»‘å®š-this" tabindex="-1">å£°æ˜ <code>Promise</code> å¹¶ç»‘å®š <code>this</code> <a class="header-anchor" href="#å£°æ˜-promise-å¹¶ç»‘å®š-this" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>\n  <span class="token comment">// å› ä¸ºçŠ¶æ€çš„å€¼æ˜¯å›ºå®šçš„ æ‰€ä»¥å®šä¹‰æˆé™æ€å±æ€§</span>\n  <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span>\n  <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span>\n  <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span>\n\n  <span class="token comment">// executor - ç¿»è¯‘ - æ‰§è¡Œè€… çš„æ„æ€</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// executor - å°±æ˜¯ - resolve å’Œ reject</span>\n    <span class="token comment">// æˆ‘å‚»äº† constructor ä¸å°±æ˜¯ä¼ é€’ new çš„æ—¶å€™ä¼ é€’çš„æ—¶å€™ ä¼ é€’çš„å‚æ•°å—...</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹æ˜¯ pending çŠ¶æ€</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// åˆå§‹è¿”å›å€¼</span>\n\n    <span class="token comment">// âš ï¸ å› ä¸ºthis ç¼˜æ•… ç„¶å bind ç»‘å®šä¸‹ thisã€‚ è®©é‡Œé¢çš„ this å°±æ˜¯å½“å‰çš„ this;</span>\n    <span class="token comment">// ğŸ“ è¿™é‡Œæ˜¯ ç»‘å®š `this` - `bind()æ–¹æ³•`</span>\n    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œ</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ä½†æ˜¯è¿™æ ·å†™å°±è¿èƒŒäº† promise çš„å•ä¸€ä¸å¯é€†çŠ¶æ€çš„ åŸåˆ™...</span>\n  <span class="token comment">// å› ä¸ºè¿™æ ·å†™ ä»ä¸Šå¾€ä¸‹ æ‰§è¡Œ å°±æ˜¯ æœ€ä¸‹æ–¹çš„çŠ¶æ€æ˜¯å“ªä¸ª å°±æ˜¯å“ªä¸ªçŠ¶æ€</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// console.log(this); // undefined å› ä¸º class é»˜è®¤éµå¾ªçš„æ˜¯ä¸¥æ ¼å±æ€§</span>\n    <span class="token comment">// ç„¶å å°±æ˜¯ undefined - å¦‚æœä¸æ˜¯çš„è¯ è¿™é‡Œé¢çš„ this å°±æ˜¯window</span>\n    \n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  \n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·" tabindex="-1"><code>çŠ¶æ€ä¿æŠ¤</code> ä¸ <code>æ‰§è¡Œè€…å¼‚æ­¥æ•è·</code> <a class="header-anchor" href="#çŠ¶æ€ä¿æŠ¤-ä¸-æ‰§è¡Œè€…å¼‚æ­¥æ•è·" aria-hidden="true">#</a></h2><ul><li><p><code>æ‰§è¡Œè€…å¼‚æ­¥æ•è·</code> - å¦‚æœåœ¨è°ƒç”¨ä»£ç çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°é”™è¯¯ï¼Œç„¶åå°±éœ€è¦ æŠŠçŠ¶æ€æ”¹æˆ <code>reject</code></p></li><li><p>æ•è·é”™è¯¯ï¼Œtry-catch</p><div class="language-js"><pre><code><span class="token keyword">try</span> <span class="token punctuation">{</span>\n  <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ğŸ“`æ‰§è¡Œè€…å¼‚æ­¥æ•è·` - amazing ğŸ˜± ç¥å¥‡</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// å› ä¸º è¿™é‡Œ `promise` çš„éœ€æ±‚å°±æ˜¯ çŠ¶æ€å•ä¸€ ä¸å¯é€†~</span>\n  <span class="token comment">// ğŸ“`çŠ¶æ€ä¿æŠ¤` - åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªä¿æŠ¤å°±å¯ä»¥äº†</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="then-çš„åŸºç¡€æ„å»º" tabindex="-1"><code>then</code> çš„åŸºç¡€æ„å»º <a class="header-anchor" href="#then-çš„åŸºç¡€æ„å»º" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿™ä¸¤ä¸ªå‡½æ•°æ„å»ºå¥½ä¹‹å å°±è‡ªåŠ¨æ‰§è¡Œè¿™ä¿©å‡½æ•°</span>\n  <span class="token comment">// onFulfilled(this.value) // resolve()æ”¹å˜ä¹‹å ç„¶åè·å–åˆ° ä¼ é€’çš„è¿™ä¸ªå€¼</span>\n  <span class="token comment">// ä½†æ˜¯å¦‚æœè¿™æ ·å†™ æˆ‘å°±ç®—ä¸ä¼ é€’å€¼ è¿™ä¸ªå€¼å°±æ˜¯ initVal-&gt; null è¿™æ ·æ˜¯ä¸å¯¹çš„  éœ€è¦ç­‰å¾… resolve ä¼ é€’</span>\n  <span class="token comment">// æ‰€ä»¥ è¿™ä¸ªonFulfilled æ–¹æ³• ä¸ä¼šè¢«ç«‹å³æ‰§è¡Œ éœ€è¦ç­‰å¾… resolved çš„çŠ¶æ€æ”¹å˜</span>\n\n  <span class="token comment">// åœ¨ `promise` è¿™ä¸¤ä¸ªçŠ¶æ€æ˜¯å¯ä»¥ä¸ä¼ çš„ åªæ˜¯ å ä½ å°±å¯ä»¥äº†ï¼Œå¯ä»¥å•ç‹¬å¤„ç† æˆåŠŸå’Œå¤±è´¥</span>\n  <span class="token comment">// ä¹Ÿæ˜¯ å¦‚æœé”™è¯¯çš„æ—¶å€™ å•ç‹¬æ‰§è¡Œ .then çš„ç¬¬ä¸€ä¸ªå‡½æ•° ä¸ä¼šæŠ¥é”™çš„ â¬‡ï¸ æ¥å¤„ç†ä¸€ä¸‹</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¦‚æœä¸ä¼  æˆ‘ä»¬å°±ç»™ä¸€ä¸ª é»˜è®¤å€¼ å°è£…ä¸€ä¸‹å‡½æ•°</span>\n    <span class="token comment">// ğŸ“âš ï¸ ä½†æ˜¯æˆ‘ä»¬çš„ then æ˜¯å¯ä»¥é“¾å¼çš„ æ‰€ä»¥æˆ‘ä»¬è¿™æ ·æ˜¯æœ‰ç‚¹ç‚¹é—®é¢˜çš„</span>\n    <span class="token comment">// -return thisæˆ–è€… return è¿™ä¸ª `class` ç±»å</span>\n    <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ğŸƒ è¿™æ ·å°±ä¸æŠ¥é”™äº†</span>\n    <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ç„¶åå°±éœ€è¦åŠ åˆ¤æ–­</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·" tabindex="-1">å®ç° <code>then</code> çš„ <code>å¼‚æ­¥æ“ä½œ</code> å’Œ <code>å¼‚å¸¸æ•è·</code> <a class="header-anchor" href="#å®ç°-then-çš„-å¼‚æ­¥æ“ä½œ-å’Œ-å¼‚å¸¸æ•è·" aria-hidden="true">#</a></h2><ul><li><p>å¦‚æœ åœ¨ <code>then</code> é‡Œé¢çš„æˆåŠŸå›è°ƒå‡½æ•° æœ‰é”™è¯¯äº† é‚£æˆ‘ä»¬åº”è¯¥ å°†å®ƒæ”¾åœ¨ <code>å¤„ç†å¼‚å¸¸</code> é‡Œé¢å»å®Œæˆ</p><div class="language-js"><pre><code><span class="token comment">// ğŸ“âš ï¸ å› ä¸ºåœ¨ åŸç”Ÿ `promise` é‡Œé¢æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¤„ç†ä¸€ä¸‹</span>\n<span class="token comment">// æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦å°†æˆ‘ä»¬çš„ä»»åŠ¡ æ”¾ç½®åœ¨ å¼‚æ­¥çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ - setTimeout</span>\n<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">try</span> <span class="token punctuation">{</span>\n        <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> \n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">try</span> <span class="token punctuation">{</span>\n\t\t\t\t<span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="promise-çš„-pending-çŠ¶æ€å¤„ç†" tabindex="-1"><code>Promise</code> çš„ <code>Pending</code> çŠ¶æ€å¤„ç† <a class="header-anchor" href="#promise-çš„-pending-çŠ¶æ€å¤„ç†" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code> çš„æ—¶å€™ åœ¨åŒæ­¥ä»£ç é‡Œé¢å†™ä¸€ä¸ª <code>setTimeout</code> æ˜¯ç­‰å¾…ä¹‹åå¯ä»¥å‡ºæ¥çš„</p></li><li><p>åœ¨æœ¬æ¬¡å®ç°çš„ ä»£ç é‡Œé¢ å°±å‡ºä¸æ¥äº† åœ¨æœ¬æ¬¡å®ç°ä¸­çš„çŠ¶æ€æ˜¯ <code>pending</code> å› ä¸ºæˆ‘ä»¬çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œ ç„¶ååˆåªåˆ¤æ–­äº† <code>æˆåŠŸå¤±è´¥</code> å¤„ç†</p><div class="language-js"><pre><code><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨è¿™é‡Œå®šä¸€ä¸ª callback åˆ—è¡¨ ç­‰å¾…æ‰§è¡Œå®Œæˆä¹‹å å†æ‹¿å‡ºæ¥æ‰§è¡Œ</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// å¼‚æ­¥å®Œæˆç»“æœä¹‹å æ”¹å˜çŠ¶æ€ å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å› ä¸ºè¿™é‡Œåœ¨ then é‡Œé¢ push è¿›å»çš„æ—¶å€™æ˜¯</span>\n    <span class="token comment">// æˆåŠŸå¤±è´¥çŠ¶æ€çš„ key-value</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// if() { ... }</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯pendingçŠ¶æ€</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// å¤„ç† å‡†å¤‡çŠ¶æ€ å¤„ç†ä¹‹åæ‰§è¡Œçš„å‡½æ•° </span>\n    <span class="token comment">// å¦‚æœå¤„äº å‡†å¤‡ çŠ¶æ€çš„æ—¶å€™ é‚£è‚¯å®šä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¸ªæ˜¯å¯ä»¥æ‰“å°å‡ºæ¥çš„</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      onFulfilled<span class="token punctuation">,</span>\n      onRejected\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// if() { ... }</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†" tabindex="-1"><code>pending</code> çš„çŠ¶æ€å¼‚å¸¸å¤„ç† <a class="header-anchor" href="#pending-çš„çŠ¶æ€å¼‚å¸¸å¤„ç†" aria-hidden="true">#</a></h2><ul><li>å¦‚æœåœ¨ pending é‡Œé¢å‡ºç° é”™è¯¯ è¿˜æ˜¯è¦äº¤ç»™ é”™è¯¯æ–¹æ³•æ¥ç»Ÿä¸€è¿›è¡Œå¤„ç†</li></ul><div class="language-js"><pre><code><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// if() { ... }</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// å› ä¸ºåœ¨ ä¸Šé¢ ä¼ é€’æ¥value å‚æ•°äº†</span>\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n          <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token comment">// ä¸Šé¢æ˜¯ push çš„å¯¹è±¡å±æ€§ è¿™é‡Œæ˜¯æ‰§è¡Œçš„å‡½æ•°</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n          <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">onRejected</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// if() { ... }</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§" tabindex="-1"><code>pending</code> çš„å¼‚æ­¥å¤„ç†æŠ€å·§ <a class="header-anchor" href="#pending-çš„å¼‚æ­¥å¤„ç†æŠ€å·§" aria-hidden="true">#</a></h2><ul><li>åœ¨ <code>promise</code> çš„åŒæ­¥é‡Œé¢ <code>resolve(&#39;123&#39;)</code> <code>console.log(&#39;223&#39;)</code> é‚£è‚¯å®šæ˜¯å…ˆè¾“å‡ºåŒæ­¥ <code>223</code></li></ul><p>ç„¶å <code>.then</code> å¼‚æ­¥äº† ç„¶åå†è¾“å‡º <code>123</code></p><ul><li><p>åœ¨æˆ‘ä»¬çš„å®ç°ä»£ç é‡Œé¢ <code>resolve()</code> è°ƒç”¨ä¹‹å ä¼šç«‹åˆ»æ‰§è¡Œ æ‰€ä»¥é¡ºåºæ‰§è¡Œäº† â¬‡ï¸ ä¿®æ”¹å¦‚ä¸‹</p><p>å› ä¸ºæˆ‘ä»¬æ”¹å˜ <code>pending</code> - <code>resolve</code> çŠ¶æ€ä¹‹å å›è°ƒç”¨ <code>resolve</code> æ–¹æ³• ç„¶ååœ¨æ‰§è¡ŒæˆåŠŸçš„æ—¶å€™ å˜æˆå¼‚æ­¥ å°±å®Œäº‹äº†</p><div class="language-js"><pre><code><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// ç„¶åå°±ä¼šåœ¨ å¼‚æ­¥ä¹‹å åˆæŠŠè¿™é‡Œçš„å¼‚æ­¥æ”¾åœ¨ä¸»çº¿ç¨‹ ç­‰å¾…æ‰§è¡Œ ç­‰ä¸‹é¢çš„åŒæ­¥æ‰§è¡Œå®Œæˆ ç„¶åå†æ‰§è¡Œ</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span> \n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span> \n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="then-é“¾å¼æ“ä½œ" tabindex="-1"><code>then</code> é“¾å¼æ“ä½œ <a class="header-anchor" href="#then-é“¾å¼æ“ä½œ" aria-hidden="true">#</a></h2><ul><li><p><code>new Promise</code> ä¹‹ <code>then</code>çš„é“¾å¼æ“ä½œ åŸç†åˆ†æ</p><div class="language-js"><pre><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;æ‹’ç»&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">&#39;æˆåŠŸ1&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">&#39;å¤±è´¥1&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¤±è´¥</span>\n  <span class="token comment">// âš ï¸ åŸç”Ÿ promise çš„å¤„ç† - ä¸Šé¢æ¥å—å®Œå¤±è´¥ä¹‹å å¤„ç†å®Œå¤±è´¥ä¹‹å ç„¶ååœ¨è¿™é‡Œ `then` ä¼šæ¥æ”¶åˆ°</span>\n  <span class="token comment">// å¤±è´¥å¤„ç†å®Œä¹‹åçš„ æ•°æ® - ä¸ä¼šèµ°åˆ° reject é‡Œé¢å»äº†</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div></li><li><p>âš ï¸ğŸ“ <code>then</code> è¿”å›çš„æ˜¯ä¸€ä¸ª <code>promise</code></p></li><li><p>âš ï¸ğŸ“ å¦‚æœä¹‹å‰è¿”å›çš„æ˜¯ æ‹’ç»çš„<code>promise</code> å¹¶ä¸ä¼šå½±å“æˆ‘ä»¬çš„ æ¥ä¸‹æ¥çš„ <code>then</code> æ–°è¿”å›çš„ <code>promise</code></p></li><li><p>âš ï¸ğŸ“ ä¾‹å¦‚ æˆ‘ä»¬ ç¬¬ä¸€ä¸ª <code>then</code> æ¥å—åˆ°å¤±è´¥å¤„ç†å®Œå¤±è´¥ã€‚ <code>return</code> çš„æ˜¯ æˆåŠŸçš„ <code>promise</code></p><div class="language-js"><pre><code><span class="token comment">// å®ç° `promise` çš„é“¾å¼æ“ä½œ</span>\n<span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// è¿™æ · .then()ä¹‹å æˆ‘ä»¬ return new Gl() å°±å¯ä»¥ - æ¥æ”¶åˆ°ä¸€ä¸ªæ–°çš„ å¼‚æ­¥äº†ã€‚</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token comment">// éœ€è¦æ”¹å˜çŠ¶æ€ è®©ä¸‹æ¬¡çš„ `then` å’Œ `catch` æ¥è¿›è¡Œæ¥æ”¶</span>\n          <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token keyword">try</span> <span class="token punctuation">{</span>\n            <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token comment">// âš ï¸ æˆåŠŸå¤±è´¥ éƒ½ä¸å½±å“ä¸‹æ¬¡ then æ“ä½œ</span>\n            <span class="token comment">// æ‰€ä»¥ éƒ½è¦ç”¨ resolve å»æŠ›</span>\n            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>\n        <span class="token punctuation">}</span> \n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n          <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‹’ç»çš„ ç„¶åé”™è¯¯å¤„ç†ä¹‹å å°±æ˜¯é»˜è®¤æ˜¯æˆåŠŸçš„äº†~</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç†</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ------------------------------ promise ---------------------------</span>\n<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;å¤±è´¥äº†&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token string">&#39;æˆåŠŸ2&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token string">&#39;å¤±è´¥2&#39;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res1&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// res1 å¤±è´¥2 è¿™é‡Œæ¥æ”¶çš„æ˜¯ ä¸Šä¸€ä¸ªå¤±è´¥å¤„ç†å®Œæˆä¹‹åçš„ æˆåŠŸçŠ¶æ€</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// ------------------ `then` æ–°å¢ `promise` å¼‚å¸¸å¤„ç† -----------------</span>\n<span class="token comment">// è§£å†³ ä¸Šä¸€ä¸ª `then` å‘ç”Ÿçš„é”™è¯¯ æˆ‘ä»¬éœ€è¦äº¤ç»™ ä¸‹ä¸€ä¸ª `then` å’Œ `catch` æ¥è¿›è¡Œå¤„ç†</span>\n<span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸäº†&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token comment">// åŒæ · æˆ‘ä»¬æŠ›å‡ºå¼‚å¸¸ throw new Error(&#39;fail&#39;) // æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥æ¥æ”¶åˆ°çš„</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aq<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div></li></ul><h2 id="å®ç°-then-çš„-ç©¿é€ä¼ é€’" tabindex="-1">å®ç° <code>then</code> çš„ ç©¿é€ä¼ é€’ <a class="header-anchor" href="#å®ç°-then-çš„-ç©¿é€ä¼ é€’" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸäº†&#39;</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="then-è¿”å›-promise-çš„å¤„ç†" tabindex="-1"><code>then</code> è¿”å› <code>promise</code> çš„å¤„ç† <a class="header-anchor" href="#then-è¿”å›-promise-çš„å¤„ç†" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ç„¶ååœ¨ æ‹’ç»çš„æ—¶å€™ è¿”å› `promise` ä¹Ÿå¯ä»¥åœ¨ä¸‹ä¸€æ¬¡ æˆåŠŸçš„æ—¶å€™ æ¥æ”¶åˆ°äº†ï½</span>\n      result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token comment">// ç„¶åå¯ä»¥ç®€å†™æˆè¿™ä¸ªæ ·å­</span>\n      <span class="token comment">// value =&gt; {</span>\n      <span class="token comment">//   resolve(value)</span>\n      <span class="token comment">// }, reason =&gt; {</span>\n      <span class="token comment">//   reject(reason)</span>\n      <span class="token comment">// }</span>\n      <span class="token comment">// )</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div><h2 id="then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–" tabindex="-1"><code>then</code> ä»£ç çš„ å†—ä½™ ä¼˜åŒ– <a class="header-anchor" href="#then-ä»£ç çš„-å†—ä½™-ä¼˜åŒ–" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token comment">// å°è£…å‡½æ•° - è§£å†³ä»£ç  å†—ä½™</span>\n<span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// - è°ƒç”¨ - </span>\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n</code></pre></div><h2 id="promise-è¿”å›ç±»å‹çš„çº¦æŸ" tabindex="-1"><code>promise</code> è¿”å›ç±»å‹çš„çº¦æŸ <a class="header-anchor" href="#promise-è¿”å›ç±»å‹çš„çº¦æŸ" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;è§£å†³&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> p <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œé¢ ä¹Ÿæ˜¯å¯ä»¥æ‰“å°åˆ°è¿™ä¸ª p çš„ å› ä¸º .then é‡Œé¢çš„æ˜¯ å¼‚æ­¥åæ‰§è¡Œ</span>\n  <span class="token comment">// return p; // ä½†æ˜¯è¿™æ ·æ˜¯ ä¸å¯ä»¥çš„ åœ¨æœ¬èº« js-promise å½“ä¸­ ä¸å…è®¸è¿”å›è‡ªå·±ã€‚</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div></li><li><p>åœ¨ <code>return new Gl()</code> æ›´æ”¹å¦‚ä¸‹ã€‚</p><div class="language-js"><pre><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">return</span> promise\n\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n<span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Chaining cycle detected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre></div></li></ul><h2 id="å®ç°-resolve-ä¸-reject" tabindex="-1">å®ç° <code>resolve</code> ä¸ <code>reject</code> <a class="header-anchor" href="#å®ç°-resolve-ä¸-reject" aria-hidden="true">#</a></h2><ul><li><p><code>resolve</code> è¿”å› æ™®é€šå€¼çš„æƒ…å†µ</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li><li><p><code>resolve</code> è¿”å› <code>promise</code>å€¼ çš„æƒ…å†µ</p><div class="language-js"><pre><code><span class="token comment">// å…ˆçœ‹ `promise` çš„å¤„ç†</span>\n<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æˆåŠŸ</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœè¿”å›æˆåŠŸ é‚£then æˆ–è€… then çš„ç¬¬ä¸€ä¸ªå‚æ•° å°±å¯ä»¥æ¥æ”¶åˆ°</span>\n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;å¤±è´¥&#39;</span><span class="token punctuation">)</span> <span class="token comment">// å°±éœ€è¦ä½¿ç”¨ catch æˆ–è€… thençš„ç¬¬äºŒä¸ªå‚æ•° å»æ¥æ”¶ã€‚</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// `Promise.resolve` è¿™è¿™é‡Œ å¦‚æœæ¥æ”¶çš„æ˜¯ä¸€ä¸ª promise å€¼çš„è¯ å°±ä¼šæŒ‰ç…§ promise çš„æˆåŠŸå¤±è´¥ å»åšå¯¹åº”çš„å¤„ç†</span>\nPromise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n  <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span>\n\n<span class="token comment">// --------------------- æ‰‹å†™ `promise` â¬‡ï¸ ---------------------</span>\n<span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="promise-çš„-all-æ–¹æ³•å®ç°" tabindex="-1"><code>promise</code> çš„ <code>All</code> æ–¹æ³•å®ç° <a class="header-anchor" href="#promise-çš„-all-æ–¹æ³•å®ç°" aria-hidden="true">#</a></h2><ul><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;éƒ­éœ–&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\nPromise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">valueAll</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>valueAll<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// å¦‚æœåˆä¸€ä¸ª å¤±è´¥çŠ¶æ€ é‚£å°±ä¸å¯¹äº†</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;err&#39;</span><span class="token punctuation">,</span> reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div></li><li><p>æ‰‹å†™ <code> promise - all</code> æ–¹æ³• â¬‡ï¸</p><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// all è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ª promise ä¸ç„¶æ€ä¹ˆä¼šæœ‰ thenå‘¢</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token parameter">reject</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n          <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æˆåŠŸä¸€ä¸ª å°± å‹å…¥ä¸€ä¸ª</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">resolve</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span> <span class="token comment">// ä»»ä½•ä¸€ä¸ªpromiseå¤±è´¥äº† å°±ç”¨æ€»çš„è¿”å›çš„ new Gl - reject æ¥å¯¹é”™è¯¯è¿›è¡Œå¤„ç†</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°" tabindex="-1"><code>promise</code>çš„<code>race</code>çš„é™æ€æ–¹æ³•å®ç° <a class="header-anchor" href="#promiseçš„raceçš„é™æ€æ–¹æ³•å®ç°" aria-hidden="true">#</a></h2><ul><li><p><code>race</code> å‘¢å°±æ˜¯ <code>è°å¿«ç”¨è°çš„</code> - ä¸ç®¡è¿”å›çš„æ˜¯å¤±è´¥è¿˜æ˜¯æˆåŠŸ å¤±è´¥èµ°å¤±è´¥çš„è°ƒç”¨ ç„¶åä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¿”å›å¤±è´¥å å°±ä¸å†è°ƒç”¨äº†</p></li><li><p>åŸç”Ÿ <code>promise</code></p><div class="language-js"><pre><code><span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&#39;p1&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token comment">// resolve(&#39;p2&#39;)</span>\n    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;p2 - error&#39;</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\nPromise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p2</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token comment">// å¦‚æœå¤±è´¥çš„æ—¶å€™ å°±éœ€è¦å†™è¿™ä¸ªå‡½æ•°å•¦</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// p2 - error</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n</code></pre></div></li><li><p>æ‰‹å†™ <code>promise - race</code> æ–¹æ³• â¬‡ï¸</p><div class="language-js"><pre><code><span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    promises<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token comment">// å› ä¸ºè¿™å—ä¹‹å‰å·²ç»å®šä¹‰äº† promise è¿”å›çŠ¶æ€ æ”¹å˜ä¹‹å å°±ä¸ä¼šå†è¾“å‡ºå€¼äº†</span>\n      promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n</code></pre></div></li></ul><h2 id="æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç " tabindex="-1">æœ€å è´´æœ€åå®ç°çš„ <code>å…¨éƒ¨ä»£ç </code> <a class="header-anchor" href="#æœ€å-è´´æœ€åå®ç°çš„-å…¨éƒ¨ä»£ç " aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Gl</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">&#39;pending&#39;</span><span class="token punctuation">;</span>\n  <span class="token keyword">static</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">&#39;fulfilled&#39;</span><span class="token punctuation">;</span>\n  <span class="token keyword">static</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">&#39;rejected&#39;</span><span class="token punctuation">;</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// console.log(this); // è¿™é‡Œçš„ this ç»™åˆ°äº† new ç»‘å®šçš„</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          item<span class="token punctuation">.</span><span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span> \n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  \n  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> reason<span class="token punctuation">;</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          item<span class="token punctuation">.</span><span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span> \n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFulfilled <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function-variable function">onFulfilled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onRejected <span class="token operator">!==</span> <span class="token string">&#39;function&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function-variable function">onRejected</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          <span class="token function-variable function">onFulfilled</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token function-variable function">onRejected</span><span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onRejected</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n            <span class="token comment">// try {</span>\n            <span class="token comment">//   let result = onRejected(reason) // âš ï¸ æˆåŠŸå¤±è´¥ éƒ½ä¸å½±å“ä¸‹æ¬¡ then æ“ä½œ</span>\n            <span class="token comment">//   // æ‰€ä»¥ éƒ½è¦ç”¨ resolve å»æŠ›</span>\n            <span class="token comment">//   resolve(result);</span>\n            <span class="token comment">// } catch (error) {</span>\n            <span class="token comment">//   reject(error)</span>\n            <span class="token comment">// }</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> Gl<span class="token punctuation">.</span><span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> promise<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> result<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Chaining cycle detected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">try</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        result<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Gl</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token function">reject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token function">all</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      promises<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n          <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>length <span class="token operator">===</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">resolve</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n            <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">static</span> <span class="token function">race</span><span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Gl</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n      promises<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">promise</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n        promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n          <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre></div>',36)];var c=n(o,[["render",function(n,p,t,o,c,u){return a(),s("div",null,e)}]]);export{t as __pageData,c as default};
